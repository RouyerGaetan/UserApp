@model List<UserApp.Models.Reservation>
<link rel="stylesheet" href="~/css/ticket.css" />

<h3>🎟️ Mes Réservations</h3>

@if (!Model.Any())
{
	<p>Aucune réservation pour le moment.</p>
}
else
{
	<table class="table table-hover">
		<thead>
			<tr>
				<th>Événement</th>
				<th>Nombre de places</th>
				<th>Statut</th>
				<th>Date</th>
				<th></th>
			</tr>
		</thead>
		<tbody>
			@foreach (var r in Model)
			{
				<tr>
					<td>@(r.Evenement?.Titre ?? "Événement supprimé")</td>
					<td>@r.NumberOfSeats</td>
					<td>@r.Status</td>
					<td>@r.ReservationDate.ToShortDateString()</td>
					<td class="d-flex align-items-center gap-2">
						<button type="button" title="Afficher le billet"
								class="btn btn-sm btn-outline-secondary"
								data-bs-toggle="modal"
								data-bs-target="#ticketModal-@r.Id">
							👁️
						</button>

						@if (r.Status == "Réservée")
						{
							<form method="post"
								  asp-controller="Reservation"
								  asp-action="Cancel"
								  asp-antiforgery="true"
								  style="display:inline;">
								<input type="hidden" name="reservationId" value="@r.Id" />
								<button type="submit"
										class="btn btn-sm btn-outline-danger"
										title="Annuler la réservation"
										onclick="return confirm('Voulez-vous vraiment annuler cette réservation ?');">
									❌ Annuler la réservation
								</button>
							</form>
						}

						<!-- Modal -->
						@await Html.PartialAsync("~/Views/Home/Partials/Shared/_TicketModal.cshtml", r)
					</td>
				</tr>
			}
		</tbody>
	</table>
}
